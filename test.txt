function updateWhatsAppLink() {
  if (!notifyBtn) return;

  // Si aún no eligió método o no hay producto, bloquea el botón
  if (!currentProduct || !currentMethod) {
    notifyBtn.href = "#";
    notifyBtn.textContent = "⚠️ Selecciona un método de pago";
    notifyBtn.className = "block mt-6 w-full bg-gray-800 text-white py-2 rounded text-center font-semibold opacity-50 pointer-events-none";
    return;
  }

  // Texto y número cuando sí hay método + producto
  const text = `Hola, ya realicé el pago por *${currentMethod}* del producto *${currentProduct.name}* por el monto de S/ ${Number(currentProduct.price).toFixed(2)}. Adjunto comprobante.`;
  const wa = toPeruE164(currentProduct?.shop?.whatsapp_number) || "51922540931";
  notifyBtn.href = `https://wa.me/${wa}?text=${encodeURIComponent(text)}`;
  notifyBtn.textContent = "✅ Ya pagué - Notificar por WhatsApp";
  notifyBtn.className = "block mt-6 w-full text-white py-2 rounded text-center font-semibold bg-green-600 hover:bg-green-700";
  notifyBtn.classList.remove("pointer-events-none", "opacity-50");
}